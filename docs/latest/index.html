<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Sniffy</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Sniffy</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#_in_browser_profiler">In-browser profiler</a></li>
<li><a href="#_asserting_number_of_queries_in_unit_tests">Asserting number of queries in unit tests</a></li>
<li><a href="#_testing_bad_connectivity">Testing bad connectivity</a></li>
<li><a href="#_simulating_no_connectivity_in_unit_tests">Simulating no connectivity in unit tests</a></li>
<li><a href="#_recording_network_traffic">Recording network traffic</a></li>
</ul>
</li>
<li><a href="#_install">Install</a>
<ul class="sectlevel1">
<li><a href="#_standalone_setup">Standalone setup</a></li>
<li><a href="#_non_servlet_applications">Non-Servlet applications</a></li>
<li><a href="#_spring_boot_integration">Spring Boot Integration</a></li>
<li><a href="#_sniffy_test">Sniffy Test</a>
<ul class="sectlevel2">
<li><a href="#_junit">JUnit</a></li>
<li><a href="#_spring_test">Spring Test</a></li>
<li><a href="#_testng">TestNG</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_setup">Setup</a>
<ul class="sectlevel1">
<li><a href="#_using_sniffy_with_spring">Using Sniffy with Spring</a></li>
<li><a href="#_datasource">Datasource</a>
<ul class="sectlevel2">
<li><a href="#_add_sniffy_to_classpath">Add sniffy to classpath</a></li>
<li><a href="#_enable_sniffy_for_datasource">Enable sniffy for datasource</a></li>
</ul>
</li>
<li><a href="#_filter">Filter</a>
<ul class="sectlevel2">
<li><a href="#_enable_sniffy_filter_in_web_xml">Enable Sniffy filter in web.xml</a></li>
</ul>
</li>
<li><a href="#_j2ee_containers">J2EE Containers</a>
<ul class="sectlevel2">
<li><a href="#_use_sniffy_with_wildfly">Use Sniffy with WildFly</a></li>
<li><a href="#_use_sniffy_with_tomcat">Use Sniffy with Tomcat</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_unit_and_component_tests">Unit and component tests</a>
<ul class="sectlevel1">
<li><a href="#_using_sniffy_api">Using Sniffy API</a>
<ul class="sectlevel2">
<li><a href="#_imperative_approach">Imperative approach</a></li>
<li><a href="#_functional_approach">Functional approach</a></li>
<li><a href="#_resource_approach">Resource approach</a></li>
</ul>
</li>
<li><a href="#_shared_connection">Shared connection</a>
<ul class="sectlevel2">
<li><a href="#_master_and_slave_connections">Master and slave connections</a></li>
<li><a href="#_example">Example</a></li>
<li><a href="#_caveats">Caveats</a></li>
</ul>
</li>
<li><a href="#_integration_with_junit">Integration with JUnit</a></li>
<li><a href="#_integration_with_kotest">Integration with Kotest</a></li>
<li><a href="#_integration_with_spring_framework">Integration with Spring Framework</a>
<ul class="sectlevel2">
<li><a href="#_sharedconnection">@SharedConnection</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_integration_with_test_ng">Integration with Test NG</a></li>
<li><a href="#_integration_with_spock_framework">Integration with Spock Framework</a></li>
</ul>
</li>
<li><a href="#_emulating_network_issues">Emulating network issues</a></li>
<li><a href="#_capturing_traffic">Capturing traffic</a>
<ul class="sectlevel1">
<li><a href="#_capture_traffic">Capture Traffic</a>
<ul class="sectlevel2">
<li><a href="#_example_2">Example</a></li>
<li><a href="#_configuration_2">Configuration</a></li>
<li><a href="#_ssltls_traffic_decryption">SSL/TLS Traffic Decryption</a></li>
<li><a href="#_caveats_2">Caveats</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_from_previous_versions">Migration from previous versions</a>
<ul class="sectlevel1">
<li><a href="#_migration_from_3_0_x_to_3_1_x">Migration from 3.0.x to 3.1.x</a>
<ul class="sectlevel2">
<li><a href="#_sniffy_filter">Sniffy Filter</a></li>
<li><a href="#_maven_artifacts">Maven artifacts</a></li>
<li><a href="#_jdbc_connection_string">JDBC Connection String</a></li>
<li><a href="#_deprecated_classes">Deprecated Classes</a></li>
<li><a href="#_deprecated_methods">Deprecated Methods</a></li>
<li><a href="#_deprecated_annotations">Deprecated annotations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy is a Java profiler which shows the results directly in your browser.
It also brings profiling to your unit (or rather component) tests and allows you to disable certain outgoing connections for fault-tolerance testing.
It can even record network traffic sent via Java plain old Socket API as well as via NIO API.</p>
</div>
<div class="sect2">
<h3 id="_in_browser_profiler">In-browser profiler</h3>
<div class="imageblock">
<div class="content">
<img src="./images/demo.gif" alt="demo">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asserting_number_of_queries_in_unit_tests">Asserting number of queries in unit tests</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Rule</span> <span class="directive">public</span> SniffyRule sniffyRule = <span class="keyword">new</span> SniffyRule();

    <span class="annotation">@Rule</span> <span class="directive">public</span> ExpectedException thrown = ExpectedException.none();

    <span class="annotation">@Test</span>
    <span class="annotation">@SqlExpectation</span>(count = <span class="annotation">@Count</span>(<span class="integer">1</span>))
    <span class="directive">public</span> <span class="type">void</span> testExpectedOneQueryGotOne() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>).createStatement().execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(4)</b>
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@SqlExpectation</span>(count = <span class="annotation">@Count</span>(max = <span class="integer">1</span>), query = SqlStatement.SELECT)
    <span class="directive">public</span> <span class="type">void</span> testExpectedNotMoreThanOneSelectGotTwo() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">try</span> (<span class="predefined-type">Statement</span> statement = <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>).createStatement()) {
            statement.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>);
            statement.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 2 FROM DUAL</span><span class="delimiter">&quot;</span></span>);
        }
        thrown.expect(WrongNumberOfQueriesError.class);
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_bad_connectivity">Testing bad connectivity</h3>
<div class="paragraph">
<p>Discover all outgoing network connections from your server and disable them right from your browser:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/network-connections.png" alt="network connections">
</div>
</div>
<div class="paragraph">
<p>Sniffy will throw a <code>java.net.ConnectException</code> when your application tries to connect to address disallowed by Sniffy.
It&#8217;s also possible to specify a fixed delay for all sent and received TCP packets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_simulating_no_connectivity_in_unit_tests">Simulating no connectivity in unit tests</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Rule</span> <span class="directive">public</span> SniffyRule sniffyRule = <span class="keyword">new</span> SniffyRule();

    <span class="annotation">@Test</span>
    <span class="annotation">@DisableSockets</span>
    <span class="directive">public</span> <span class="type">void</span> testDisableSockets() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="keyword">try</span> {
            <span class="keyword">new</span> <span class="predefined-type">Socket</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">google.com</span><span class="delimiter">&quot;</span></span>, <span class="integer">22</span>);
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sniffy should have thrown ConnectException</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">ConnectException</span> e) {
            assertNotNull(e);
        }
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recording_network_traffic">Recording network traffic</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testCaptureTraffic() <span class="directive">throws</span> <span class="exception">Exception</span> {

        <span class="keyword">try</span> (Spy&lt;?&gt; spy = Sniffy.spy(
                SpyConfiguration.builder().captureNetworkTraffic(<span class="predefined-constant">true</span>).build()) // <b class="conum">(1)</b>
        ) {

            performSocketOperation(); // <b class="conum">(2)</b>

            <span class="predefined-type">Map</span>&lt;SocketMetaData, <span class="predefined-type">List</span>&lt;NetworkPacket&gt;&gt; networkTraffic = spy.getNetworkTraffic( // <b class="conum">(3)</b>
                    Threads.ANY, // <b class="conum">(4)</b>
                    AddressMatchers.anyAddressMatcher(), // <b class="conum">(5)</b>
                    GroupingOptions.builder().
                            groupByThread(<span class="predefined-constant">false</span>). // <b class="conum">(6)</b>
                            groupByStackTrace(<span class="predefined-constant">false</span>). // <b class="conum">(7)</b>
                            groupByConnection(<span class="predefined-constant">false</span>). // <b class="conum">(8)</b>
                            build()
            );

            assertEquals(<span class="integer">1</span>, networkTraffic.size());

            <span class="keyword">for</span> (<span class="predefined-type">Map</span>.Entry&lt;SocketMetaData, <span class="predefined-type">List</span>&lt;NetworkPacket&gt;&gt; entry : networkTraffic.entrySet()) {

                SocketMetaData socketMetaData = entry.getKey(); // <b class="conum">(9)</b>

                Protocol protocol = socketMetaData.getProtocol(); <span class="comment">// say TCP</span>
                <span class="predefined-type">String</span> hostName = socketMetaData.getAddress().getHostName(); <span class="comment">// say &quot;hostname.acme.com&quot;</span>
                <span class="type">int</span> port = socketMetaData.getAddress().getPort(); <span class="comment">// say 443</span>

                <span class="predefined-type">List</span>&lt;NetworkPacket&gt; networkPackets = entry.getValue(); // <b class="conum">(10)</b>

                assertArrayEquals(REQUEST, networkPackets.get(<span class="integer">0</span>).getBytes());
                assertTrue(networkPackets.get(<span class="integer">0</span>).isSent());

                assertArrayEquals(RESPONSE, networkPackets.get(<span class="integer">1</span>).getBytes());
                assertFalse(networkPackets.get(<span class="integer">1</span>).isSent());

            }

        }

    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_install" class="sect0">Install</h1>
<div class="sect1">
<h2 id="_standalone_setup">Standalone setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy comes with an uber-jar which doesn&#8217;t require any additional dependencies to be installed.
Just grab the <code>sniffy-3.1.11.jar</code> from our <a href="https://github.com/sniffy/sniffy/releases/latest">releases page</a> and add it to the classpath of your application.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you&#8217;re using an application server like Tomcat and you&#8217;re defining a datasource on application server level, <code>sniffy-3.1.11.jar</code> should be added to the common classloader classpath and should be <strong>absent</strong> in web application classpath.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_non_servlet_applications">Non-Servlet applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Standalone sniffy uber-jar also works with non-Servlet applications (Currently only fault tolerance testing and TCP delay are supported in this mode).
Just add following parameter to your java application command line:
<code>-javaagent:sniffy-&lt;VERSION&gt;.jar=5559</code></p>
</div>
<div class="paragraph">
<p>Here <code>5559</code> is the port where connectivity controls are available - just point your browser to 5559 port on your host (Say <a href="http://localhost:5559" class="bare">http://localhost:5559</a> ).
Below is an example of connections discovered in IntelliJ Idea:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/agent-ui.png" alt="agent ui">
</div>
</div>
<div class="paragraph">
<p>Advanced syntax takes comma separated parameters: <code>-javaagent:sniffy-&lt;VERSION&gt;.jar=sniffyPort=5559,monitorNio=true</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_boot_integration">Spring Boot Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re using Spring Boot, add the dependency below to your project in order to use Sniffy.</p>
</div>
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.sniffy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>sniffy-web<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.1.11<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile <span class="string"><span class="delimiter">'</span><span class="content">io.sniffy:sniffy-web:3.1.11</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sniffy_test">Sniffy Test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy artifacts for unit test frameworks are distributed via Maven Central repository and can be downloaded using your favorite package manager.</p>
</div>
<div class="sect2">
<h3 id="_junit">JUnit</h3>
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.sniffy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>sniffy-junit<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.1.11<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">io.sniffy:sniffy-junit:3.1.11</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_test">Spring Test</h3>
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.sniffy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>sniffy-spring-test<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.1.11<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">io.sniffy:sniffy-spring-test:3.1.11</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testng">TestNG</h3>
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.sniffy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>sniffy-testng<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.1.11<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">io.sniffy:sniffy-testng:3.1.11</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_setup" class="sect0">Setup</h1>
<div class="sect1">
<h2 id="_using_sniffy_with_spring">Using Sniffy with Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using <a href="http://projects.spring.io/spring-boot/">Spring Boot</a>, simply add <code>@EnableSniffy</code> to your application class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="keyword">import</span> <span class="include">io.sniffy.boot.EnableSniffy</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="annotation">@EnableAutoConfiguration</span>
<span class="annotation">@EnableSniffy</span> // <b class="conum">(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Application</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">ClassNotFoundException</span> {
        SpringApplication.run(Application.class, args);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Put this annotation on a class with spring configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It will wrap all existing datasources with <code>SniffyDataSource</code> and also create an instance of <code>SniffyFilter</code> with bean id <code>sniffyFilter</code> which will inject sniffy widget into HTML pages.
If you are using Spring Boot embedded servlet container t is sufficient - otherwise you should also create a mapping for this filter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_datasource">Datasource</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_add_sniffy_to_classpath">Add sniffy to classpath</h3>
<div class="paragraph">
<p>In order to intercept the SQL queries executed by your application you should use Sniffy datasource wrapper.
At first you should add <code>sniffy.jar</code> to classpath of classloader which loads actual driver.
If your datasource is created by application server and registered in JNDI for later usage, you should copy <code>sniffy.jar</code>
 so it would be available by application server common classloader.
For example in case of <code>Apache Tomcat</code> you should place it to <code>&lt;TOMCAT-HOME&gt;/lib</code> folder</p>
</div>
</div>
<div class="sect2">
<h3 id="_enable_sniffy_for_datasource">Enable sniffy for datasource</h3>
<div class="paragraph">
<p>In order to enable sniffy on a datasource, just add <code>sniffy:</code> prefix and use <code>io.sniffy.sql.SniffyDriver</code> as a driver class name.
For example <code>jdbc:h2:~/test</code> should be changed to <code>sniffy:jdbc:h2:mem:</code>
The Sniffy JDBC driver class name to <code>io.sniffy.sql.SniffyDriver</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filter">Filter</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_enable_sniffy_filter_in_web_xml">Enable Sniffy filter in web.xml</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>sniffer<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>io.sniffy.servlet.SniffyFilter<span class="tag">&lt;/filter-class&gt;</span>
    <span class="tag">&lt;async-supported&gt;</span>true<span class="tag">&lt;/async-supported&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>enabled<span class="tag">&lt;/param-name&gt;</span> <b class="conum">(1)</b>
        <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span> <span class="comment">&lt;!-- default: true --&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>exclude-pattern<span class="tag">&lt;/param-name&gt;</span> <b class="conum">(2)</b>
        <span class="tag">&lt;param-value&gt;</span>^/vets.html$<span class="tag">&lt;/param-value&gt;</span> <span class="comment">&lt;!-- optional --&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>inject-html<span class="tag">&lt;/param-name&gt;</span> <b class="conum">(3)</b>
        <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span> <span class="comment">&lt;!-- default: true --&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>inject-html-exclude-pattern<span class="tag">&lt;/param-name&gt;</span> <b class="conum">(4)</b>
        <span class="tag">&lt;param-value&gt;</span>^/peds.html$<span class="tag">&lt;/param-value&gt;</span> <span class="comment">&lt;!-- optional --&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>monitor-socket<span class="tag">&lt;/param-name&gt;</span> <b class="conum">(5)</b>
        <span class="tag">&lt;param-value&gt;</span>false<span class="tag">&lt;/param-value&gt;</span> <span class="comment">&lt;!-- default: true --&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
<span class="tag">&lt;/filter&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>sniffer<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Allows disabling the Sniffy filter in <code>web.xml</code></p>
</li>
<li>
<p>Allows excluding some of the request URL&#8217;s from Sniffer filter</p>
</li>
<li>
<p>Enables injection of Sniffy toolbar to HTML. If disabled the html remains untouched. You still can get the number of executed queries from <code>Sniffy-Sql-Queries</code> HTTP header.</p>
</li>
<li>
<p>Allows excluding of Sniffy toolbar injection to some of the request URL&#8217;s</p>
</li>
<li>
<p>Allows disabling socket monitoring functionality; will also disable fault tolerance testing features</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Apart from obvious <code>false</code> and <code>true</code> values, you can set <code>inject-html</code> and 'enabled' parameters to a <code>system</code> value.
It will act as described in table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Sniffy Filter Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">-Dio.sniffy.filterEnabled or IO_SNIFFY_FILTER_ENABLED</th>
<th class="tableblock halign-left valign-top">enabled filter init param</th>
<th class="tableblock halign-left valign-top">Effective value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">absent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">absent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">absent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Similar rules are applied to <code>inject-html</code> filter parameter</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_j2ee_containers">J2EE Containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Integration of Sniffy with Servlet / J2EE containers is pretty straightforward - you should follow the instructions for setting up Sniffy DataSource and Filter above.
However some containers are using complicated ClassLoader&#8217;s and require some additional steps.</p>
</div>
<div class="sect2">
<h3 id="_use_sniffy_with_wildfly">Use Sniffy with WildFly</h3>
<div class="paragraph">
<p>If you want to use Sniffy with WildFly you need to add it as a <code>module</code>.</p>
</div>
<div class="paragraph">
<p>In order to do that unzip the <code>sniffy-{VERSION}-jboss-module.zip</code> (available in maven Nexus central repository as <code>io.sniffy:sniffy:jar:jboss-module</code> artifact) archive to <code>modules/system/layers/base</code> folder.
Edit the <code>modules/system/layers/base/io/sniffy/main/module.xml</code> file and specify a module containing your actual JDBC driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;module</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:module:1.3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.sniffy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;resources&gt;</span>
        <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/resources&gt;</span>

    <span class="tag">&lt;dependencies&gt;</span>
        <span class="comment">&lt;!-- Try import some well known modules with JDBC drivers --&gt;</span>
        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.h2database.h2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">optional</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.oracle</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">optional</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.jdbc</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">optional</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.oracle.jdbc</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">optional</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- insert a reference to module with your JDBC driver here --&gt;</span>

        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.servlet.api</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sun.jdk</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/module&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can use <code>io.sniffy</code> module. At first we should change the DataSource configuration in <code>standalone/configuration/standalone.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;datasources&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use-java-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;connection-url&gt;</span>sniffy:jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<span class="tag">&lt;/connection-url&gt;</span>
            <span class="tag">&lt;driver&gt;</span>sniffy<span class="tag">&lt;/driver&gt;</span>
            <span class="tag">&lt;security&gt;</span>
                <span class="tag">&lt;user-name&gt;</span>sa<span class="tag">&lt;/user-name&gt;</span>
                <span class="tag">&lt;password&gt;</span>sa<span class="tag">&lt;/password&gt;</span>
            <span class="tag">&lt;/security&gt;</span>
        <span class="tag">&lt;/datasource&gt;</span>
        <span class="tag">&lt;drivers&gt;</span>
            <span class="tag">&lt;driver</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.sniffy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;xa-datasource-class&gt;</span>io.sniffy.sql.SniffyDataSource<span class="tag">&lt;/xa-datasource-class&gt;</span>
            <span class="tag">&lt;/driver&gt;</span>
        <span class="tag">&lt;/drivers&gt;</span>
<span class="tag">&lt;/datasources&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we should import <code>io.sniffy</code> module to your web application in order to be able to use <code>SniffyFilter</code>.
Edit the <code>jboss-deployment-structure.xml</code> file inside your web application and add a reference to <code>io.sniffy</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-deployment-structure&gt;</span>
    <span class="tag">&lt;deployment&gt;</span>
        <span class="tag">&lt;dependencies&gt;</span>
            <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.sniffy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/dependencies&gt;</span>
    <span class="tag">&lt;/deployment&gt;</span>
<span class="tag">&lt;/jboss-deployment-structure&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_sniffy_with_tomcat">Use Sniffy with Tomcat</h3>
<div class="paragraph">
<p>If you&#8217;re using datasources managed within Tomcat rather that within your web application, place <code>sniffy-&lt;VERSION&gt;.jar</code> to the <code>lib</code> folder
And add <code>sniffy:</code> prefix to the Datasource configuration in <code>conf/server.xml</code> file. For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Resource</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/myoracle</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Container</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.sql.DataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">driverClassName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.sniffy.sql.SniffyDriver</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:oracle:thin:@127.0.0.1:1521:mysid</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scott</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tiger</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxTotal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxIdle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">maxWaitMillis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure that in this setup you do not have sniffy jars in your web application class path (i.e. WEB-INF/lib folder)
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<h1 id="_configuration" class="sect0">Configuration</h1>
<div class="paragraph">
<p>Sniffy can be configured globally using Java system properties or environment variables.
This configuration can be overriden in <code>web.xml</code> and/or <code>@EnableSniffy</code> annotation - see appropriate sections of documentation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
sniffy configuration is parsed only once and any changes made to system properties or environment variables in run-time won&#8217;t have any effect on <code>Sniffy</code>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Table Configuration properties</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Environment Variable</th>
<th class="tableblock halign-left valign-top">Sniffy Agent parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.logLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_LOG_LEVEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sniffy logging level; allowed values are: TRACE, DEBUG, INFO, ERROR, OFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.monitorJdbc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_MONITOR_JDBC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitor JDBC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.monitorSocket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_MONITOR_SOCKET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitor socket connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false (enabled implicitly by Sniffy javaagent or SniffyFiler)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.monitorNio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_MONITOR_NIO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">monitorNio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitor NIO socket connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false (enabled implicitly by Sniffy javaagent or SniffyFiler)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.topSqlCapacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_TOP_SQL_CAPACITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of top SQL queries to store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.packetMergeThreshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_PACKET_MERGE_THRESHOLD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threshold for combining similar network packets when capturing traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.filterEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_FILTER_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable servlet filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.excludePattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_EXCLUDE_PATTERN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regexp for excluding sniffy completely from certain servlet requests</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.injectHtml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_INJECT_HTML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inject Sniffy HTML to result HTML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.injectHtmlExcludePattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_INJECT_HTML_EXCLUDE_PATTERN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regexp for excluding sniffy widget from certain servlet requests</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sniffyPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP port Sniffy Agent is listening on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5555</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.socketCaptureEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_SOCKET_CAPTURE_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable collecting network stats (bytes sent/received, time spent) if monitorSocket or monitorNio are enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.decryptTls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_DECRYPT_TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable decrypting captured TLS traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dio.sniffy.socketFaultInjectionEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO_SNIFFY_SOCKET_FAULT_INJECTION_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable injecting network faults if monitorSocket or monitorNio are enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Sniffy filter can also be enabled or disabled using HTTP query parameters and/or HTTP headers.</p>
</div>
<div class="paragraph">
<p>If Sniffy filter is currently disabled you can enable it by adding <code>?sniffy=true</code> query parameter to your request -
it will enable the sniffy for current request and will also set a <code>sniffy</code> cookie which will enable sniffy on subsequent requests.</p>
</div>
<div class="paragraph">
<p>For stateless clients who don&#8217;t maintain the cookie jar it might be more convenient to enable/disable Sniffy using <code>Sniffy-Enabled: true</code> / <code>Sniffy-Enabled: false</code> headers.
Unlike the query parameter the HTTP header will only affect a single request.</p>
</div>
<div class="paragraph">
<p>A similar header <code>Sniffy-Inject-Html-Enabled</code> can be used for hiding or showing the Sniffy Widget in the browser.
Unlike <code>Sniffy-Enabled</code> It doesn&#8217;t come with a query parameter alternative.</p>
</div>
<div class="paragraph">
<p>Convenient <a href="https://chrome.google.com/webstore/detail/sniffy-chrome-extension/hmiejljajpgikfbajggcolnblbhfedjp?hl=en">Sniffy Chrome Extension</a> can add these headers by simply clicking on an icon in your Google Chrome browser.</p>
</div>
<h1 id="_unit_and_component_tests" class="sect0">Unit and component tests</h1>
<div class="sect1">
<h2 id="_using_sniffy_api">Using Sniffy API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy provides a convenient API for validating the number of executed database queries, affected database rows or even number of active TCP connections.
The main classes you should use are <code>io.sniffy.Sniffy</code> and <code>io.sniffy.Spy</code>.</p>
</div>
<div class="paragraph">
<p><code>Spy</code> objects are responsible for recording the executed queries and bytes sent over the wire. <code>Spy</code> stores all the information since the moment it was created.
<code>Sniffy</code> class provides convenient factory methods for creating <code>Spy</code> instances</p>
</div>
<div class="sect2">
<h3 id="_imperative_approach">Imperative approach</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="predefined-type">Connection</span> connection = <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(1)</b>
        Spy&lt;?&gt; spy = Sniffy.spy(); // <b class="conum">(2)</b>
        connection.createStatement().execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(3)</b>
        spy.verify(SqlQueries.atMostOneQuery()); // <b class="conum">(4)</b>
        spy.verify(SqlQueries.noneQueries().otherThreads()); // <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Just add <code>sniffy:</code> in front of your JDBC connection URL in order to enable sniffer.</p>
</li>
<li>
<p><code>Spy</code> holds the amount of queries executed till the given amount of time. It acts as a base for further assertions.</p>
</li>
<li>
<p>You do not need to modify your JDBC code.</p>
</li>
<li>
<p><code>spy.verify(SqlQueries.atMostOneQuery())</code> throws an AssertionError if more than one query was executed.</p>
</li>
<li>
<p><code>spy.verify(SqlQueries.noneQueries().otherThreads())</code> throws an AssertionError if at least one query was executed by the thread other than then current one.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_functional_approach">Functional approach</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="directive">final</span> <span class="predefined-type">Connection</span> connection = <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(1)</b>
        Sniffy.execute(
                () -&gt; connection.createStatement().execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>)
        ).verify(SqlQueries.atMostOneQuery()); // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Just add <code>sniffy:</code> in front of your JDBC connection URL in order to enable sniffer.</p>
</li>
<li>
<p><code>Sniffy.execute()</code> method executes the lambda expression and returns an instance of <code>Spy</code> which provides methods for validating the number of executed queries in given lambda/</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_resource_approach">Resource approach</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="directive">final</span> <span class="predefined-type">Connection</span> connection = <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(1)</b>
        <span class="keyword">try</span> (<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">unused</span><span class="delimiter">&quot;</span></span>) Spy s = Sniffy. // <b class="conum">(2)</b>
                expect(SqlQueries.atMostOneQuery()).
                expect(SqlQueries.noneQueries().otherThreads());
             <span class="predefined-type">Statement</span> statement = connection.createStatement()) {
            statement.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>);
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Just add <code>sniffy:</code> in front of your JDBC connection URL in order to enable sniffer.</p>
</li>
<li>
<p>You can use <code>Sniffy</code> in a try-with-resource block using <code>expect</code> methods instead of <code>verify</code>. When the try-with-resource block is completed, Sniffy will verify all the expectations defined</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shared_connection">Shared connection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some test scenarios you might want to execute all SQL commands in a single connection even though your code under test obtains multiple connections.
The major use case is starting a transaction in the beginning of your test and rolling it back at the end.
Using shared connection will force you application to use this particular transaction and connection even if you work will multiple threads/transactions/connections.</p>
</div>
<div class="paragraph">
<p><code>SharedConnectionDataSource</code> is a wrapper around any other <code>DataSource</code> with two additional methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> SharedConnectionDataSource(<span class="predefined-type">DataSource</span> targetDataSource);

<span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">void</span> setCurrentThreadAsMaster();

<span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">void</span> resetMasterConnection() <span class="directive">throws</span> <span class="exception">InterruptedException</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Call <code>setCurrentThreadAsMaster()</code> method when you want to switch your DataSource to a shared connection mode.
After you call this method, all new connections obtained from this DataSourcce will actually reuse the same underlying connection</p>
</div>
<div class="paragraph">
<p>Call <code>resetMasterConnection()</code> when your test is finished and you want to return the data source to the ordinary state.</p>
</div>
<div class="sect2">
<h3 id="_master_and_slave_connections">Master and slave connections</h3>
<div class="paragraph">
<p>In <code>SharedConnectionDataSource</code> there&#8217;s one <code>master</code> connection and multiple <code>slave</code> connections.
All operations affecting the connection (such as close, commit, rollback, e.t.c.) are suppressed in slave connections, i.e. they do nothing.</p>
</div>
<div class="paragraph">
<p>This how master connection is determined:
- If there is an active connection obtained in the same thread as one calling <code>setCurrentThreadAsMaster()</code>, this connection is marked as master
- Otherwise the first connection obtained  in the same thread as one calling <code>setCurrentThreadAsMaster()</code> will be marked as master</p>
</div>
</div>
<div class="sect2">
<h3 id="_example">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        SharedConnectionDataSource sharedConnectionDataSource = <span class="keyword">new</span> SharedConnectionDataSource(targetDataSource); // <b class="conum">(1)</b>

        sharedConnectionDataSource.setCurrentThreadAsMaster(); // <b class="conum">(2)</b>

        <span class="keyword">try</span> (<span class="predefined-type">Connection</span> masterConnection = sharedConnectionDataSource.getConnection(); // <b class="conum">(3)</b>
             <span class="predefined-type">Connection</span> slaveConnection = newSingleThreadExecutor().submit(
                     (<span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Connection</span>&gt;) sharedConnectionDataSource::getConnection).get() // <b class="conum">(4)</b>
        ) {
            assertEquals(masterConnection, slaveConnection); // <b class="conum">(5)</b>
        } <span class="keyword">finally</span> {
            sharedConnectionDataSource.resetMasterConnection(); // <b class="conum">(6)</b>
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a <code>SharedConnectionDataSource</code> wrapper by passing an underlying DataSource to the constructor</p>
</li>
<li>
<p>Mark current Thread as <code>master</code> - first connection obtained from this thread will be considered <code>master</code></p>
</li>
<li>
<p>Get the master connection from the pool</p>
</li>
<li>
<p>Get the slave connection from the pool. It is slave cause called from another thread and master connection is already determined</p>
</li>
<li>
<p>Assert that connections are actually the same</p>
</li>
<li>
<p>Release the master connection. This call will for all slave connetions to finish (until <code>close()</code> method is called) and unmark current thread and connection as master</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_caveats">Caveats</h3>
<div class="paragraph">
<p>Although all API calls which might affect the shared connection in slave connections, it is still possible to interfere with other connections.
For example any DDL calls (like CREATE TABLE) commit the transaction implicitly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_junit">Integration with JUnit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy comes with a <a href="http://junit.org/">JUnit</a> <code>@Rule</code> for quick integration with test framework.
Just add <code>@Rule public final SniffyRule sniffyRule = new SniffyRule();</code> to your JUnit test class and place appropriate expectations on your test methods like shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">io.sniffy.test.junit.usage</span>;

<span class="keyword">import</span> <span class="include">io.sniffy.socket.DisableSockets</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.sql.SqlExpectation</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.Count</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.junit.SniffyRule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Rule</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.net.ConnectException</span>;
<span class="keyword">import</span> <span class="include">java.net.Socket</span>;
<span class="keyword">import</span> <span class="include">java.sql.Connection</span>;
<span class="keyword">import</span> <span class="include">java.sql.DriverManager</span>;
<span class="keyword">import</span> <span class="include">java.sql.SQLException</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertNotNull</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.fail</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JUnitUsageTest</span> {

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> <span class="directive">final</span> SniffyRule sniffyRule = <span class="keyword">new</span> SniffyRule(); // <b class="conum">(1)</b>

    <span class="annotation">@Test</span>
    <span class="annotation">@SqlExpectation</span>(count = <span class="annotation">@Count</span>(<span class="integer">1</span>)) // <b class="conum">(2)</b>
    <span class="directive">public</span> <span class="type">void</span> testJUnitIntegration() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="directive">final</span> <span class="predefined-type">Connection</span> connection = <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(3)</b>
        connection.createStatement().execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(4)</b>
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@DisableSockets</span> // <b class="conum">(5)</b>
    <span class="directive">public</span> <span class="type">void</span> testDisableSockets() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="keyword">try</span> {
            <span class="keyword">new</span> <span class="predefined-type">Socket</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">google.com</span><span class="delimiter">&quot;</span></span>, <span class="integer">22</span>); // <b class="conum">(6)</b>
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sniffy should have thrown ConnectException</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">ConnectException</span> e) {
            assertNotNull(e);
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>- Integrate Sniffy to your test using @Rule annotation and a SniffyRule field.</p>
</li>
<li>
<p>- Now just add <code>@SqlExpectation</code> annotation to define number of queries allowed for given method.</p>
</li>
<li>
<p>- Just add <code>sniffy:</code> in front of your JDBC connection URL in order to enable sniffer.</p>
</li>
<li>
<p>- Do not make any changes in your code - just add the <code>@Rule SniffyRule</code> and put annotations on your test method.</p>
</li>
<li>
<p>- Add <code>@DisableSockets</code> annotation on your test method or test class and any attempt to open a network connection will fail</p>
</li>
<li>
<p>- All socket operations executed within test method annotated with <code>@DisableSockets</code> will throw a <code>java.net.ConnectException</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_kotest">Integration with Kotest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy comes with a <a href="https://kotest.io/">Kotest</a> <code>TestCaseExtension`s for quick integration with test framework.
Just add `DisableSocketsExtension</code> to simulate network isolation in your tests or <code>SniffyExtension</code> to assert number of executed queries and/or opened connections</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package io.sniffy.test.kotest.usage

import com.hazelcast.client.HazelcastClient
import com.hazelcast.client.config.*
import com.hazelcast.config.Config
import com.hazelcast.config.NetworkConfig
import com.hazelcast.core.Hazelcast
import com.hazelcast.core.HazelcastInstance
import io.kotest.assertions.fail
import io.kotest.core.extensions.TestCaseExtension
import io.kotest.core.spec.style.StringSpec
import io.kotest.core.test.TestCase
import io.kotest.core.test.TestResult
import io.kotest.core.test.TestStatus
import io.kotest.matchers.shouldBe
import io.kotest.matchers.shouldNotBe
import io.kotest.matchers.types.instanceOf
import io.ktor.client.*
import io.ktor.client.engine.apache.*
import io.ktor.client.request.*
import io.sniffy.SniffyAssertionError

class ExpectSniffyAssertionExceptionExtension : TestCaseExtension {

    override suspend fun intercept(testCase: TestCase, execute: suspend (TestCase) -&gt; TestResult): TestResult {
        val testResult = execute(testCase)
        try {
            testResult.error shouldBe instanceOf(SniffyAssertionError::class)
        } catch (e: Exception) {
            return testResult.copy(status = TestStatus.Failure, error = e)
        }
        return TestResult.success(testResult.duration)
    }
}

class KotestUsageTests : StringSpec({

    @Suppress(&quot;BlockingMethodInNonBlockingContext&quot;)
    &quot;Ktor HTTP Client should be intercepted by Sniffy&quot;.config(extensions = listOf( // <b class="conum">(1)</b>
            ExpectSniffyAssertionExceptionExtension(),
            NoSocketsAllowedExtension() // <b class="conum">(2)</b>
    )) {

        val client = HttpClient(Apache)

        client.get(&quot;https://en.wikipedia.org/wiki/Main_Page&quot;)

    }

    &quot;Hazelcast client should be intercepted by Sniffy&quot;.config(
            extensions = listOf(DisableSocketsExtension())) {// <b class="conum">(3)</b>

        val serverConfig: Config = Config(&quot;my-hazelcast&quot;).apply {
            networkConfig = NetworkConfig().apply {
                port = 6600
                portCount = 1
            }
        }

        val hzInstance: HazelcastInstance = Hazelcast.newHazelcastInstance(serverConfig)
        hzInstance.getMap&lt;Any, Any&gt;(&quot;my-distributed-map&quot;).put(&quot;key&quot;, &quot;value&quot;)

        try {
            val config = ClientConfig().apply {
                instanceName = &quot;my-hazelcast&quot;
                networkConfig = ClientNetworkConfig().apply {
                    addresses = listOf(&quot;localhost:6600&quot;)
                }
                connectionStrategyConfig = ClientConnectionStrategyConfig().apply {
                    connectionRetryConfig = ConnectionRetryConfig().apply {
                        initialBackoffMillis = 50
                        maxBackoffMillis = 100
                        clusterConnectTimeoutMillis = 200
                    }
                }
            }
            val failoverConfig = ClientFailoverConfig().apply {
                tryCount = 1
                clientConfigs = listOf(config)
            }
            val hazelcastClient = HazelcastClient.newHazelcastFailoverClient(failoverConfig)
            hazelcastClient.getMap&lt;Any, Any&gt;(&quot;my-distributed-map&quot;).get(&quot;key&quot;) shouldBe &quot;value&quot;
            fail(&quot;Should have been refused by Sniffy&quot;)
        } catch (e: Exception) {
            e shouldNotBe null
        } finally {
            hzInstance.shutdown()
        }

    }

})</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>- Integrate Sniffy to your test by adding appropriate extensions</p>
</li>
<li>
<p>- <code>NoSocketsAllowedExtension</code> would fail your test if it accesses network</p>
</li>
<li>
<p>- <code>DisableSocketsExtension</code> can be used for simulating network isolation for your code</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_spring_framework">Integration with Spring Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy comes with a <a href="http://projects.spring.io/spring-framework/">Spring Framework</a> via <code>SniffySpringTestListener</code> spring <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config">@TestExecutionListener</a>.
Just add <code>@TestExecutionListeners(SniffySpringTestListener.class)</code> to your Spring test class and place appropriate expectations on your test methods like shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">io.sniffy.test.spring.usage</span>;

<span class="keyword">import</span> <span class="include">io.sniffy.socket.DisableSockets</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.sql.SqlExpectation</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.Count</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.spring.SniffySpringTestListener</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.runner.RunWith</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.ContextConfiguration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.TestExecutionListeners</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.net.ConnectException</span>;
<span class="keyword">import</span> <span class="include">java.net.Socket</span>;
<span class="keyword">import</span> <span class="include">java.sql.Connection</span>;
<span class="keyword">import</span> <span class="include">java.sql.SQLException</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.sql.DriverManager.getConnection</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertNotNull</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.fail</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.test.context.TestExecutionListeners.MergeMode.MERGE_WITH_DEFAULTS</span>;

<span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = SpringUsageTest.class)
<span class="annotation">@TestExecutionListeners</span>(value = SniffySpringTestListener.class, mergeMode = MERGE_WITH_DEFAULTS) // <b class="conum">(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringUsageTest</span> {

    <span class="annotation">@Test</span>
    <span class="annotation">@SqlExpectation</span>(count = <span class="annotation">@Count</span>(max = <span class="integer">1</span>))
    <span class="directive">public</span> <span class="type">void</span> testJUnitIntegration() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="directive">final</span> <span class="predefined-type">Connection</span> connection = getConnection(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>);
        connection.createStatement().execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@DisableSockets</span> // <b class="conum">(5)</b>
    <span class="directive">public</span> <span class="type">void</span> testDisableSockets() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="keyword">try</span> {
            <span class="keyword">new</span> <span class="predefined-type">Socket</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">google.com</span><span class="delimiter">&quot;</span></span>, <span class="integer">443</span>); // <b class="conum">(6)</b>
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sniffy should have thrown ConnectException</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">ConnectException</span> e) {
            assertNotNull(e);
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>- Integrate Sniffy to your test using <code>@TestExecutionListeners(SniffySpringTestListener.class)</code>.</p>
</li>
<li>
<p>- Now just add <code>@SqlExpectation</code> annotation to define number of queries allowed for given method.</p>
</li>
<li>
<p>- Just add <code>sniffy:</code> in front of your JDBC connection URL in order to enable sniffer.</p>
</li>
<li>
<p>- Do not make any changes in your code - just add the <code>@TestExecutionListeners(SniffySpringTestListener.class)</code> and put annotations on your test method.</p>
</li>
<li>
<p>- Add <code>@DisableSockets</code> annotation on your test method or test class and any attempt to open a network connection will fail</p>
</li>
<li>
<p>- All socket operations executed within test method annotated with <code>@DisableSockets</code> will throw a <code>java.net.ConnectException</code></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_sharedconnection">@SharedConnection</h3>
<div class="paragraph">
<p>Sniffy provides convenient annotations for shared connection data source in Spring unit tests.
Consider example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">io.sniffy.test.spring.usage</span>;

<span class="keyword">import</span> <span class="include">io.sniffy.test.spring.DataSourceTestConfiguration</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.spring.EnableSharedConnection</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.spring.SharedConnection</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.spring.SniffySpringTestListener</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.runner.RunWith</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>;
<span class="keyword">import</span> <span class="include">org.springframework.jdbc.core.JdbcTemplate</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.annotation.Rollback</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.ContextConfiguration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.TestExecutionListeners</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span>;
<span class="keyword">import</span> <span class="include">org.springframework.transaction.annotation.Transactional</span>;
<span class="keyword">import</span> <span class="include">ru.yandex.qatools.allure.annotations.Features</span>;

<span class="keyword">import</span> <span class="include">java.sql.SQLException</span>;
<span class="keyword">import</span> <span class="include">java.util.Arrays</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.ExecutionException</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.util.concurrent.Executors.newSingleThreadExecutor</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertEquals</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.test.context.TestExecutionListeners.MergeMode.MERGE_WITH_DEFAULTS</span>;

<span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = {DataSourceTestConfiguration.class, SpringSharedConnectionUsageTest.class})
<span class="annotation">@TestExecutionListeners</span>(value = SniffySpringTestListener.class, mergeMode = MERGE_WITH_DEFAULTS) // <b class="conum">(1)</b>
<span class="annotation">@EnableSharedConnection</span> // <b class="conum">(2)</b>
<span class="annotation">@Transactional</span>
<span class="annotation">@Rollback</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringSharedConnectionUsageTest</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> JdbcTemplate jdbcTemplate;

    <span class="annotation">@Test</span>
    <span class="annotation">@SharedConnection</span> // <b class="conum">(3)</b>
    <span class="annotation">@Features</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">issue/344</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> testSharedConnectionTwoRows() <span class="directive">throws</span> <span class="exception">SQLException</span>, <span class="exception">ExecutionException</span>, <span class="exception">InterruptedException</span> {

        jdbcTemplate.batchUpdate(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO PUBLIC.PROJECT (ID, NAME) VALUES (SEQ_PROJECT.NEXTVAL, ?)</span><span class="delimiter">&quot;</span></span>,
                <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>}, <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>})
        ); // <b class="conum">(4)</b>

        assertEquals(<span class="integer">2</span>, newSingleThreadExecutor().submit(
                () -&gt; jdbcTemplate.queryForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT COUNT(*) FROM PUBLIC.PROJECT</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class) // <b class="conum">(5)</b>
        ).get().intValue());

    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>- Integrate Sniffy to your test using <code>@TestExecutionListeners(SniffySpringTestListener.class)</code>.</p>
</li>
<li>
<p>- <code>@EnableSharedConnection</code> will automatically wrap all your data sources with <code>SharedConnectionDataSource</code></p>
</li>
<li>
<p>- <code>@SharedConnection</code> annotation will make the current connection (started because of <code>@Transactional</code> annotation before each test) as master</p>
</li>
<li>
<p>- Insert two rows into table using master connection</p>
</li>
<li>
<p>- Another slave connection obtained in another thread will still see the results of these inserts although the isolation level is <code>READ_COMITTED</code> and master transaction has not been committed</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting">Troubleshooting</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Spring test context is no longer loaded when I add <code>@TestExecutionListeners(SniffySpringTestListener.class)</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The reason is that by default Spring does not merge the test execution listeners.
Using this configuration you&#8217;re removing the predefined listeners which initialize the context.
Change the <em>mergeMode</em> parameter to <em>MERGE_WITH_DEFAULTS</em> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TestExecutionListeners</span>(value = SniffySpringTestListener.class, mergeMode = MERGE_WITH_DEFAULTS)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_test_ng">Integration with Test NG</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy comes with a <a href="http://testng.org/">Test NG</a> <code>listener</code> for quick integration with test framework.
Just add <code>@Listeners(SniffyTestNgListener.class)</code> to your TestNG test class and place appropriate expectations on your test methods like shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">io.sniffy.test.testng.usage</span>;

<span class="keyword">import</span> <span class="include">io.sniffy.socket.DisableSockets</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.sql.SqlExpectation</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.Count</span>;
<span class="keyword">import</span> <span class="include">io.sniffy.test.testng.SniffyTestNgListener</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Listeners</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.net.ConnectException</span>;
<span class="keyword">import</span> <span class="include">java.net.Socket</span>;
<span class="keyword">import</span> <span class="include">java.sql.Connection</span>;
<span class="keyword">import</span> <span class="include">java.sql.DriverManager</span>;
<span class="keyword">import</span> <span class="include">java.sql.SQLException</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertNotNull</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.fail</span>;

<span class="annotation">@Listeners</span>(SniffyTestNgListener.class) // <b class="conum">(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UsageTestNg</span> {

    <span class="annotation">@Test</span>
    <span class="annotation">@SqlExpectation</span>(count = <span class="annotation">@Count</span>(<span class="integer">1</span>)) // <b class="conum">(2)</b>
    <span class="directive">public</span> <span class="type">void</span> testJUnitIntegration() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="directive">final</span> <span class="predefined-type">Connection</span> connection = <span class="predefined-type">DriverManager</span>.getConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(3)</b>
        connection.createStatement().execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>); // <b class="conum">(4)</b>
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@DisableSockets</span> // <b class="conum">(5)</b>
    <span class="directive">public</span> <span class="type">void</span> testDisableSockets() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="keyword">try</span> {
            <span class="keyword">new</span> <span class="predefined-type">Socket</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">google.com</span><span class="delimiter">&quot;</span></span>, <span class="integer">22</span>); // <b class="conum">(6)</b>
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sniffy should have thrown ConnectException</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">ConnectException</span> e) {
            assertNotNull(e);
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>- Integrate <code>Sniffy</code> to your test using <code>@Listeners(SniffyTestNgListener.class)</code>.</p>
</li>
<li>
<p>- Now just add <code>@SqlExpectation</code> annotation to define number of queries allowed for given method.</p>
</li>
<li>
<p>- Just add <code>sniffy:</code> in front of your JDBC connection URL in order to enable sniffer.</p>
</li>
<li>
<p>- Do not make any changes in your code - just add the <code>@Listeners(SniffyTestNgListener.class)</code> and put annotations on your test method.</p>
</li>
<li>
<p>- Add <code>@DisableSockets</code> annotation on your test method or test class and any attempt to open a network connection will fail</p>
</li>
<li>
<p>- All socket operations executed within test method annotated with <code>@DisableSockets</code> will throw a <code>java.net.ConnectException</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_spock_framework">Integration with Spock Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/spockframework/spock">Spock Framework</a> is a developer testing and specification framework for Java and <a href="http://groovy.codehaus.org/">Groovy</a> applications.</p>
</div>
<div class="paragraph">
<p>Sniffy can be integrated with Spock Framework using <code>Spy</code> field and standard spock <code>then</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> io.sniffy.test.spock.usage

<span class="keyword">import</span> <span class="include">groovy.sql.Sql</span>
<span class="keyword">import</span> <span class="include">io.sniffy.Sniffy</span>
<span class="keyword">import</span> <span class="include">io.sniffy.sql.SqlQueries</span>
<span class="keyword">import</span> <span class="include">io.sniffy.sql.WrongNumberOfQueriesError</span>
<span class="keyword">import</span> <span class="include">spock.lang.FailsWith</span>
<span class="keyword">import</span> <span class="include">spock.lang.Shared</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">SpockUsageSpec</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Shared</span> sql = Sql.newInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">sniffy:jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>)

    <span class="keyword">def</span> spy = Sniffy.spy()

    <span class="annotation">@FailsWith</span>(WrongNumberOfQueriesError)
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Execute single query - negative</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>)
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>:
        spy.verify(SqlQueries.exactQueries(<span class="integer">1</span>))
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Execute single query</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>:
        spy.verify(SqlQueries.exactQueries(<span class="integer">1</span>)).reset()

        <span class="key">when</span>:
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>:
        spy.verify(SqlQueries.exactQueries(<span class="integer">1</span>))
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Execute single query - another one</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1 FROM DUAL</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>:
        spy.verify(SqlQueries.exactQueries(<span class="integer">1</span>))
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do not forget to call <code>reset()</code> method on the spy object if you have multiple when-then blocks in a single test method</p>
</div>
</div>
</div>
<h1 id="_emulating_network_issues" class="sect0">Emulating network issues</h1>
<div class="paragraph">
<p>Sniffy uses heuristics to add delay for TCP connections.</p>
</div>
<div class="paragraph">
<p>Say we have specified a delay of <em>D</em> milliseconds and have the <em>R</em> receive buffer and <em>S</em> send buffer</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Establishing connection adds <em>D</em> milliseconds delay</p>
</li>
<li>
<p>Sending <em>N</em> bytes where <em>(n - 1) * S &lt; N &lt; n * S</em> adds <em>n * D</em> milliseconds delay</p>
</li>
<li>
<p>Receiving <em>N</em> bytes where <em>(n - 1) * R &lt; N &lt; n * R</em> adds <em>n * D</em> milliseconds delay</p>
</li>
<li>
<p>Sending anything in the same thread as reading will trigger a delay on subsequent receive and vice versa</p>
</li>
<li>
<p>Calling sendUrgentData(int) method alls <em>D</em> milliseconds delay</p>
</li>
<li>
<p>Closing connection adds <em>D</em> milliseconds delay</p>
</li>
</ul>
</div>
<h1 id="_capturing_traffic" class="sect0">Capturing traffic</h1>
<div class="sect1">
<h2 id="_capture_traffic">Capture Traffic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sniffy allows you to record traffic sent or received via network and exposes it via Java API.</p>
</div>
<div class="sect2">
<h3 id="_example_2">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testCaptureTraffic() <span class="directive">throws</span> <span class="exception">Exception</span> {

        <span class="keyword">try</span> (Spy&lt;?&gt; spy = Sniffy.spy(
                SpyConfiguration.builder().captureNetworkTraffic(<span class="predefined-constant">true</span>).build()) // <b class="conum">(1)</b>
        ) {

            performSocketOperation(); // <b class="conum">(2)</b>

            <span class="predefined-type">Map</span>&lt;SocketMetaData, <span class="predefined-type">List</span>&lt;NetworkPacket&gt;&gt; networkTraffic = spy.getNetworkTraffic( // <b class="conum">(3)</b>
                    Threads.ANY, // <b class="conum">(4)</b>
                    AddressMatchers.anyAddressMatcher(), // <b class="conum">(5)</b>
                    GroupingOptions.builder().
                            groupByThread(<span class="predefined-constant">false</span>). // <b class="conum">(6)</b>
                            groupByStackTrace(<span class="predefined-constant">false</span>). // <b class="conum">(7)</b>
                            groupByConnection(<span class="predefined-constant">false</span>). // <b class="conum">(8)</b>
                            build()
            );

            assertEquals(<span class="integer">1</span>, networkTraffic.size());

            <span class="keyword">for</span> (<span class="predefined-type">Map</span>.Entry&lt;SocketMetaData, <span class="predefined-type">List</span>&lt;NetworkPacket&gt;&gt; entry : networkTraffic.entrySet()) {

                SocketMetaData socketMetaData = entry.getKey(); // <b class="conum">(9)</b>

                Protocol protocol = socketMetaData.getProtocol(); <span class="comment">// say TCP</span>
                <span class="predefined-type">String</span> hostName = socketMetaData.getAddress().getHostName(); <span class="comment">// say &quot;hostname.acme.com&quot;</span>
                <span class="type">int</span> port = socketMetaData.getAddress().getPort(); <span class="comment">// say 443</span>

                <span class="predefined-type">List</span>&lt;NetworkPacket&gt; networkPackets = entry.getValue(); // <b class="conum">(10)</b>

                assertArrayEquals(REQUEST, networkPackets.get(<span class="integer">0</span>).getBytes());
                assertTrue(networkPackets.get(<span class="integer">0</span>).isSent());

                assertArrayEquals(RESPONSE, networkPackets.get(<span class="integer">1</span>).getBytes());
                assertFalse(networkPackets.get(<span class="integer">1</span>).isSent());

            }

        }

    }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>captureNetworkTraffic(true)</code> when creating a <code>Spy</code> instance to enable traffic capturing</p>
</li>
<li>
<p>Invoke socket operation. Can be either in current or another thread. Plain socket API or NIO - doesn&#8217;t matter.</p>
</li>
<li>
<p>Retrieve network packets filtered and grouped as defined in parameters</p>
</li>
<li>
<p>Allows you to filter traffic by thread</p>
</li>
<li>
<p>Allows you to filter traffic by target address and/or port</p>
</li>
<li>
<p>Group traffic by thread</p>
</li>
<li>
<p>Group traffic by stack trace</p>
</li>
<li>
<p>Group traffic by connection id - surrogate identifier of network connection</p>
</li>
<li>
<p>SocketMetaData describes the target host and port and other parameters as described above for <code>GroupingOptions</code></p>
</li>
<li>
<p><code>NetworkPacket</code> contains data in bytes, timestamp, direction and optional stacktrace and thread information</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2">Configuration</h3>
<div class="paragraph">
<p><code>packetMergeThreshold</code> allows you to specify threshold for combining similar network packets when capturing traffic.
For example if your application calls <code>SocketInputStream.read()</code> 8 times in a row to read a 64-bit value, Sniffy will merge these calls into a single packet given that they were done within specified threshold and of course given that no write/sent operation was done between them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ssltls_traffic_decryption">SSL/TLS Traffic Decryption</h3>
<div class="paragraph">
<p>Sniffy can decrypt capture traffic but you need to enable this feature explicitly using -D`io.sniffy.decryptTls` system property or <code>IO_SNIFFY_DECRYPT_TLS</code> environment variable.
It&#8217;s also possible to enable it programmatically using  <code>io.sniffy.configuration.SniffyConfiguration.INSTANCE.setDecryptTls()</code> method.</p>
</div>
<div class="paragraph">
<p>Decrypted traffic is available along with original traffic using dedicated <code>getDecryptedNetworkTraffic</code> method in Spy class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;SocketMetaData, <span class="predefined-type">List</span>&lt;NetworkPacket&gt;&gt; decryptedNetworkTraffic = spy.getDecryptedNetworkTraffic(
        Threads.CURRENT,
        AddressMatchers.exactAddressMatcher(<span class="string"><span class="delimiter">&quot;</span><span class="content">www.google.com:443</span><span class="delimiter">&quot;</span></span>),
        GroupingOptions.builder().
                groupByConnection(<span class="predefined-constant">false</span>).
                groupByStackTrace(<span class="predefined-constant">false</span>).
                groupByThread(<span class="predefined-constant">false</span>).
                build()
);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_caveats_2">Caveats</h3>
<div class="paragraph">
<p>Some libraries like Apache APR and Netty (only when native transport is enabled explicitly) use native code for network operations.
Currently Sniffy doesn&#8217;t capture this kind of traffic.</p>
</div>
</div>
</div>
</div>
<h1 id="_migration_from_previous_versions" class="sect0">Migration from previous versions</h1>
<div class="sect1">
<h2 id="_migration_from_3_0_x_to_3_1_x">Migration from 3.0.x to 3.1.x</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_sniffy_filter">Sniffy Filter</h3>
<div class="paragraph">
<p>Starting from version <code>3.1.0</code> injection of HTML is no longer considered experimental and enabled by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maven_artifacts">Maven artifacts</h3>
<div class="paragraph">
<p>Sniffy test support has been extracted to a separate artifacts.
You should now use following artifacts if you want to use Sniffy in your unit tests:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Table Maven artifacts migration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old artifact</th>
<th class="tableblock halign-left valign-top">New artifact</th>
<th class="tableblock halign-left valign-top">Test framework</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy-junit:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JUnit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy-spring-test:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Framework</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy-testng:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TestNG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy:sniffy-core:test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spock Framework</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_jdbc_connection_string">JDBC Connection String</h3>
<div class="paragraph">
<p><code>sniffer:</code> connection is deprecated as of Sniffy 3.1.0.
You should use <code>sniffy:</code> instead like shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>sniffy:jdbc:h2:mem:</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deprecated_classes">Deprecated Classes</h3>
<div class="paragraph">
<p>Some of Sniffy classes are deprecated as of version 3.1.0 with an equivalent replacement as shown in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Table Sniffy 3.1.0 deprecated classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated class</th>
<th class="tableblock halign-left valign-top">New class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.MockDriver</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.sql.SniffyDriver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.Query</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.sql.SqlStatement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.Sniffer</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.Sniffy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.WrongNumberOfQueriesError</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.sql.WrongNumberOfQueriesError</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.servlet.SnifferFilter</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.servlet.SniffyFilter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.junit.QueryCounter</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.test.junit.SniffyRule</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.spring.QueryCounterListener</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.test.spring.SniffySpringTestListener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.Expectation</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.sql.SqlExpectation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.Expectations</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.sql.SqlExpectations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.NoQueriesAllowed</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.sql.NoSql</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">io.sniffy.testng.QueryCounter</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.sniffy.test.testng.SniffyTestNgListener</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_deprecated_methods">Deprecated Methods</h3>
<div class="sect3">
<h4 id="_io_sniffy_sniffer">io.sniffy.Sniffer.*</h4>
<div class="paragraph">
<p>Some methods in <code>io.sniffy.Sniffer</code> class are now deprecated and although they&#8217;re still available in <code>io.sniffy.Sniffy</code> class they will be removed completely in future versions of Sniffy.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Table io.sniffy.Sniffer deprecated methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated method</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">executedStatements()</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spy().getExecutedStatements(Threads threadMatcher, boolean removeStackTraces)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">expect*(&#8230;&#8203;)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">expect(Spy.Expectation expectation)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_io_sniffy_spy">io.sniffy.Spy.*</h4>
<div class="paragraph">
<p>Some methods in <code>io.sniffy.Spy</code> class are now deprecated and will be removed completely in future versions of Sniffy.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Table io.sniffy.Spy deprecated methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated method</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">executedStatements()</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spy().getExecutedStatements(Threads threadMatcher, boolean removeStackTraces)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">expect*(&#8230;&#8203;)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">expect(Spy.Expectation expectation)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="line-through">verify*(&#8230;&#8203;)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">verify(Spy.Expectation expectation)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deprecated_annotations">Deprecated annotations</h3>
<div class="paragraph">
<p><code class="line-through">@EnableSniffy(excludePattern="&#8230;&#8203;")</code> has been deprecated in favor of <code>@EnableSniffy(advanced = @SniffyAdvancedConfiguration(excludePattern = "&#8230;&#8203;",))</code></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-23 00:58:52 UTC
</div>
</div>
</body>
</html>